#!/usr/bin/env python3

# AI Disclaimer:
# This script was generated by a LLM.

import os
import re
import requests

def extract_video_id(filename):
    match = re.search(r'\[([a-zA-Z0-9_-]+)\]', filename)
    if match:
        return match.group(1)
    return None

def download_thumbnail(video_id, save_path):
    # Fetch the TikTok video page
    url = f'https://www.tiktok.com/oembed?url=https://www.tiktok.com/@user/video/{video_id}'
    response = requests.get(url)
    if response.status_code != 200:
        print(f'Failed to fetch the video page for video ID: {video_id}')
        return

    # Extract the thumbnail URL from the JSON response
    data = response.json()
    thumbnail_url = data.get('thumbnail_url')
    if not thumbnail_url:
        print(f'Failed to find the thumbnail URL for video ID: {video_id}')
        return

    response = requests.get(thumbnail_url)
    if response.status_code == 200:
        with open(save_path, 'wb') as file:
            file.write(response.content)
        print(f'Thumbnail downloaded for video ID: {video_id}')
    else:
        print(f'Failed to download thumbnail for video ID: {video_id}')

def main():
    video_extensions = {'.mp4', '.mkv', '.webm', '.avi', '.mov'}
    current_directory = os.getcwd()
    for filename in os.listdir(current_directory):
        if os.path.splitext(filename)[1].lower() in video_extensions:
            video_id = extract_video_id(filename)
            if video_id:
                thumbnail_path = os.path.join(current_directory, f'{os.path.splitext(filename)[0]}-poster.jpg')
                download_thumbnail(video_id, thumbnail_path)

if __name__ == '__main__':
    main()